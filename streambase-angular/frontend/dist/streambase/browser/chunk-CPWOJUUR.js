import{a as j}from"./chunk-XEMNCAPA.js";import{n as B}from"./chunk-7FPOL3XV.js";import{a as U,b as W,c as G,d as J,e as K,f as Q,g as X,h as Z,i as ee,j as te,k as ne,l as ie,m as oe}from"./chunk-MQYQHKKF.js";import"./chunk-Y5HT4N7P.js";import{r as I,t as V,u as F,v as $,w as L,x as N,y as Y}from"./chunk-IMHAIZ3T.js";import{na as H,oa as z}from"./chunk-VFXDPC4I.js";import{Ab as h,Hb as i,Ib as r,Jb as P,Kb as g,Lb as v,Nb as M,Qb as c,Sb as _,Tc as D,Vc as A,Yc as E,a as C,ab as w,ac as y,b,bc as a,cb as l,cc as q,dc as O,ia as S,jc as R,ma as x,nc as k,qc as T,ua as m,ub as u,va as d,yb as f}from"./chunk-EDYQIVRR.js";var ae=(n,e,t)=>({pending:n,approved:e,declined:t});function se(n,e){n&1&&(i(0,"th",22),a(1,"Movie Title"),r())}function le(n,e){if(n&1&&(i(0,"td",23),a(1),r()),n&2){let t=e.$implicit;l(),q(t.movieTitle)}}function ce(n,e){n&1&&(i(0,"th",24),a(1," Media Type "),r())}function me(n,e){if(n&1&&(i(0,"td",25),a(1),r()),n&2){let t=e.$implicit;l(),O(" ",t.mediaType==="tv"?"TV":"Movie"," ")}}function de(n,e){n&1&&(i(0,"th",24),a(1," Year of Release "),r())}function pe(n,e){if(n&1&&(i(0,"td",25),a(1),r()),n&2){let t=e.$implicit;l(),O(" ",t.year," ")}}function ue(n,e){if(n&1){let t=M();i(0,"th",24),a(1," Request Date "),i(2,"div",26)(3,"button",27),c("click",function(){m(t);let s=_(2);return d(s.handleSortByRequestDate("desc"))}),i(4,"mat-icon",28),a(5,"arrow_downward"),r()(),i(6,"button",27),c("click",function(){m(t);let s=_(2);return d(s.handleSortByRequestDate("asc"))}),i(7,"mat-icon",28),a(8,"arrow_upward"),r()()()()}}function fe(n,e){if(n&1&&(i(0,"td",25),a(1),r()),n&2){let t=e.$implicit,o=_(2);l(),O(" ",o.formatDate(t.createdAt)," ")}}function _e(n,e){n&1&&(i(0,"th",24),a(1,"Status"),r())}function ge(n,e){if(n&1&&(i(0,"td",25)(1,"mat-icon",29),a(2," fiber_manual_record "),r()()),n&2){let t=e.$implicit,o=_(2);l(),f("matTooltip",o.getStatusLabel(t))("ngClass",k(2,ae,t.status==="pending",t.status==="approved",t.status==="declined"))}}function ve(n,e){n&1&&(i(0,"th",24),a(1,"Actions"),r())}function he(n,e){if(n&1){let t=M();i(0,"td",25)(1,"button",30),c("click",function(){let s=m(t).$implicit,p=_(2);return d(p.handleApprove(s))}),i(2,"mat-icon"),a(3,"check_circle"),r()(),i(4,"button",31),c("click",function(){let s=m(t).$implicit,p=_(2);return d(p.handleDecline(s))}),i(5,"mat-icon"),a(6,"cancel"),r()()()}if(n&2){let t=e.$implicit;l(),f("disabled",t.status==="approved"||t.status==="declined"),l(3),f("disabled",t.status==="approved"||t.status==="declined")}}function Me(n,e){n&1&&P(0,"tr",32)}function Ce(n,e){n&1&&P(0,"tr",33)}function be(n,e){if(n&1){let t=M();i(0,"div")(1,"table",8),g(2,9),u(3,se,2,0,"th",10)(4,le,2,1,"td",11),v(),g(5,12),u(6,ce,2,0,"th",13)(7,me,2,1,"td",14),v(),g(8,15),u(9,de,2,0,"th",13)(10,pe,2,1,"td",14),v(),g(11,16),u(12,ue,9,0,"th",13)(13,fe,2,1,"td",14),v(),g(14,17),u(15,_e,2,0,"th",13)(16,ge,3,6,"td",14),v(),g(17,18),u(18,ve,2,0,"th",13)(19,he,7,2,"td",14),v(),u(20,Me,1,0,"tr",19)(21,Ce,1,0,"tr",20),r(),i(22,"mat-paginator",21),c("page",function(s){m(t);let p=_();return d(p.handlePageEvent(s))}),r()()}if(n&2){let t=_();l(),f("dataSource",t.getPaginatedData()),l(19),f("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),l(),f("matRowDefColumns",t.displayedColumns),l(),f("length",t.filteredRequests.length)("pageSize",t.rowsPerPage)("pageSizeOptions",t.pageSizeOptions)}}function Pe(n,e){n&1&&(i(0,"div",34),P(1,"mat-spinner"),r())}var re=class n{requests=[];filteredRequests=[];loading=!0;activeFilter="all";sortDirection="asc";page=0;rowsPerPage=20;pageSizeOptions=[20,50,100];displayedColumns=["movieTitle","mediaType","year","requestDate","status","actions"];hideHeader=!1;lastScrollTop=0;adminMovieService=S(j);notificationsService=S(B);ngOnInit(){this.fetchMovieRequests()}fetchMovieRequests(){this.loading=!0,this.adminMovieService.fetchMovieRequests().subscribe({next:e=>{this.requests=e,this.applyFilter(),this.loading=!1},error:e=>{console.error("Error fetching movie requests:",e),this.loading=!1}})}applyFilter(){if(!this.requests||this.requests.length===0){this.filteredRequests=[];return}this.handleSortByRequestDate(this.sortDirection),this.activeFilter==="all"?this.filteredRequests=[...this.requests]:this.filteredRequests=this.requests.filter(e=>e.status===this.activeFilter)}handleFilter(e){this.activeFilter=e,this.page=0,this.applyFilter()}handleApprove(e){this.adminMovieService.approveMovieRequest(e.id,e.movieTitle,e.mediaType).subscribe({next:()=>{let t=b(C({},e),{status:"approved"});this.updateRequestInList(t),this.notificationsService.sendNotification({date:new Date().toISOString(),from:"Admin1",to:e.senderId,message:`Your request for ${e.movieTitle} was approved. You can now view it on Streambase.`,read:!1}).subscribe()},error:t=>{if(t.message==="Movie not found on TMDB"){let o=b(C({},e),{status:"declined",reason:"Movie not found on TMDB"});this.updateRequestInList(o),this.notificationsService.sendNotification({date:new Date().toISOString(),from:"Admin1",to:e.senderId,message:`Sorry! The movie "${e.movieTitle}" was not found. Please check the title and year, and try again.`,read:!1}).subscribe();return}console.error("Error approving request:",t.message)}})}handleDecline(e){this.adminMovieService.declineMovieRequest(e.id).subscribe({next:()=>{let t=b(C({},e),{status:"declined"});this.updateRequestInList(t),this.notificationsService.sendNotification({date:new Date().toISOString(),from:"Admin1",to:e.senderId,message:`Sorry! Your request for ${e.movieTitle} was declined.`,read:!1}).subscribe()},error:t=>{console.error("Error declining request:",t)}})}updateRequestInList(e){this.requests=this.requests.map(t=>t.id===e.id?e:t),this.applyFilter()}handlePageEvent(e){this.page=e.pageIndex,this.rowsPerPage=e.pageSize}handleSortByRequestDate(e){this.sortDirection=e,this.filteredRequests=[...this.filteredRequests].sort((t,o)=>e==="desc"?new Date(o.createdAt).getTime()-new Date(t.createdAt).getTime():new Date(t.createdAt).getTime()-new Date(o.createdAt).getTime())}formatDate(e){let t=new Date(e);return t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})+", "+t.toLocaleTimeString("en-US",{hour12:!1})}getPaginatedData(){let e=this.page*this.rowsPerPage;return this.filteredRequests.slice(e,e+this.rowsPerPage)}getStatusLabel(e){switch(e.status){case"pending":return"Pending Approval";case"approved":return"Approved";case"declined":return e.reason?`Declined - ${e.reason}`:"Declined";default:return"Unknown Status"}}onWindowScroll(){let e=window.scrollY;e>this.lastScrollTop?this.hideHeader=!0:this.hideHeader=!1,this.lastScrollTop=e<=0?0:e}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=x({type:n,selectors:[["app-admin-movie-requests"]],hostBindings:function(t,o){t&1&&c("scroll",function(){return o.onWindowScroll()},!1,w)},standalone:!0,features:[R],decls:18,vars:12,consts:[["loadingSpinner",""],[1,"admin-requests-container"],[1,"scroll-header"],[1,"heading"],[1,"filter-buttons"],["mat-button","",3,"click"],["matTooltip","Refresh","aria-label","Refresh",1,"refresh-mat-icon",3,"click"],[4,"ngIf","ngIfElse"],["mat-table","",1,"mat-elevation-z1","requests-table",3,"dataSource"],["matColumnDef","movieTitle"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","mediaType"],["mat-header-cell","","class","center-align",4,"matHeaderCellDef"],["mat-cell","","class","center-align",4,"matCellDef"],["matColumnDef","year"],["matColumnDef","requestDate"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["aria-label","Select page",3,"page","length","pageSize","pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"center-align"],["mat-cell","",1,"center-align"],[1,"sort-buttons"],["mat-icon-button","",3,"click"],[1,"sort-icon"],[1,"status-indicator",3,"matTooltip","ngClass"],["mat-icon-button","","matTooltip","Approve","color","primary",3,"click","disabled"],["mat-icon-button","","matTooltip","Decline","color","warn",3,"click","disabled"],["mat-header-row",""],["mat-row",""],[1,"loading-container"]],template:function(t,o){if(t&1){let s=M();i(0,"div",1)(1,"div",2)(2,"h1",3),a(3,"Movie Requests"),r(),i(4,"div",4)(5,"button",5),c("click",function(){return m(s),d(o.handleFilter("pending"))}),a(6," Pending "),r(),i(7,"button",5),c("click",function(){return m(s),d(o.handleFilter("approved"))}),a(8," Approved "),r(),i(9,"button",5),c("click",function(){return m(s),d(o.handleFilter("declined"))}),a(10," Declined "),r(),i(11,"button",5),c("click",function(){return m(s),d(o.handleFilter("all"))}),a(12," All "),r(),i(13,"mat-icon",6),c("click",function(){return m(s),d(o.fetchMovieRequests())}),a(14,"refresh"),r()()(),u(15,be,23,7,"div",7)(16,Pe,2,0,"ng-template",null,0,T),r()}if(t&2){let s=y(17);l(),h("hidden",o.hideHeader),l(4),h("active-filter",o.activeFilter==="pending"),l(2),h("active-filter",o.activeFilter==="approved"),l(2),h("active-filter",o.activeFilter==="declined"),l(2),h("active-filter",o.activeFilter==="all"),l(4),f("ngIf",!o.loading)("ngIfElse",s)}},dependencies:[E,D,A,oe,G,K,ee,Q,J,te,X,Z,ne,ie,W,U,F,I,V,z,H,Y,N,L,$],styles:[".dark-theme[_ngcontent-%COMP%]{--primary-color: #000000;--secondary-color: #FEB508;--background-color: #070501;--surface-color: #1e1e1e;--text-primary: #ffffff;--text-secondary: rgb(255, 255, 255);--error-color: #d30808;--success-color: #08920c}.dark-theme[_ngcontent-%COMP%]   .mat-toolbar.mat-primary[_ngcontent-%COMP%]{background-color:#000;color:#fff}.dark-theme[_ngcontent-%COMP%]   .mat-button.mat-primary[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   .mat-icon-button.mat-primary[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   .mat-stroked-button.mat-primary[_ngcontent-%COMP%]{color:#feb508}.dark-theme[_ngcontent-%COMP%]   .mat-raised-button.mat-primary[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   .mat-fab.mat-primary[_ngcontent-%COMP%], .dark-theme[_ngcontent-%COMP%]   .mat-mini-fab.mat-primary[_ngcontent-%COMP%]{background-color:#feb508;color:#000}.dark-theme[_ngcontent-%COMP%]   .mat-menu-panel[_ngcontent-%COMP%]{background-color:#1e1e1e;color:#fff}.dark-theme[_ngcontent-%COMP%]   .mat-menu-item[_ngcontent-%COMP%]{color:#fff}.dark-theme[_ngcontent-%COMP%]   .mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled]){background-color:#ffffff1a}.dark-theme[_ngcontent-%COMP%]   .mat-menu-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#fff}.dark-theme[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{border-top-color:#ffffff1f}.light-theme[_ngcontent-%COMP%]{--primary-color: #ffffff;--secondary-color: #f5c518;--background-color: #f5f5f5;--surface-color: #ffffff;--text-primary: rgba(0, 0, 0, .87);--text-secondary: rgba(0, 0, 0, .6);--error-color: #b00020;--success-color: #4caf50}.light-theme[_ngcontent-%COMP%]   .mat-toolbar.mat-primary[_ngcontent-%COMP%]{background-color:#fff;color:#000000de}.light-theme[_ngcontent-%COMP%]   .mat-button.mat-primary[_ngcontent-%COMP%], .light-theme[_ngcontent-%COMP%]   .mat-icon-button.mat-primary[_ngcontent-%COMP%], .light-theme[_ngcontent-%COMP%]   .mat-stroked-button.mat-primary[_ngcontent-%COMP%]{color:#feb508}.light-theme[_ngcontent-%COMP%]   .mat-raised-button.mat-primary[_ngcontent-%COMP%], .light-theme[_ngcontent-%COMP%]   .mat-fab.mat-primary[_ngcontent-%COMP%], .light-theme[_ngcontent-%COMP%]   .mat-mini-fab.mat-primary[_ngcontent-%COMP%]{background-color:#feb508;color:#fff}.light-theme[_ngcontent-%COMP%]   .mat-menu-panel[_ngcontent-%COMP%]{background-color:#fff;color:#000000de}.light-theme[_ngcontent-%COMP%]   .mat-menu-item[_ngcontent-%COMP%]{color:#000000de}.light-theme[_ngcontent-%COMP%]   .mat-menu-item[_ngcontent-%COMP%]:hover:not([disabled]){background-color:#0000000a}.light-theme[_ngcontent-%COMP%]   .mat-menu-item[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{color:#0000008a}.light-theme[_ngcontent-%COMP%]   .mat-divider[_ngcontent-%COMP%]{border-top-color:#0000001f}[_nghost-%COMP%]{--mat-table-background-color: transparent;--mat-table-header-background-color: transparent;--mat-table-row-background-color: transparent;--mat-table-row-hover-background-color: transparent}[_nghost-%COMP%]     .mat-mdc-paginator{--mat-paginator-container-background-color: transparent;background:transparent!important}.admin-requests-container[_ngcontent-%COMP%]{margin:50px 25px 25px;padding:40px}.scroll-header[_ngcontent-%COMP%]{position:fixed;top:64px;left:0;right:0;height:64px;background-color:#070501;display:flex;align-items:center;justify-content:space-between;z-index:500;transition:transform .3s ease;padding:0 80px}.scroll-header.hidden[_ngcontent-%COMP%]{transform:translateY(-100%)}.heading[_ngcontent-%COMP%]{font-weight:700;margin:0}.refresh-mat-icon[_ngcontent-%COMP%]{color:#feb508;font-size:28px;vertical-align:middle;cursor:pointer;transition:color .3s ease,transform .3s ease;margin-left:12px}.refresh-mat-icon[_ngcontent-%COMP%]:active{transform:scale(.85)}.filter-buttons[_ngcontent-%COMP%]{display:flex;gap:8px}.filter-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:1px solid rgba(51,51,51,.5);border-radius:20px;height:30px;font-size:12px}.filter-buttons[_ngcontent-%COMP%]   button.active-filter[_ngcontent-%COMP%]{background-color:#feb508;color:#070501}.filter-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(.active-filter){background-color:transparent;color:#fff}.filter-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(.active-filter):hover{background-color:#252424;color:#fff}.requests-table[_ngcontent-%COMP%]{width:100%}.requests-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:700;font-size:16px}.requests-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{font-size:14px}.center-align[_ngcontent-%COMP%]{text-align:center}.sort-buttons[_ngcontent-%COMP%]{display:inline-flex;vertical-align:middle}.sort-buttons[_ngcontent-%COMP%]   .sort-icon[_ngcontent-%COMP%]{color:#807e7e;font-size:18px;transition:color .3s ease,transform .3s ease}.sort-buttons[_ngcontent-%COMP%]   .sort-icon[_ngcontent-%COMP%]:hover{color:#feb508;transform:scale(1.2)}.status-indicator[_ngcontent-%COMP%]{font-size:16px;cursor:pointer}.status-indicator.pending[_ngcontent-%COMP%]{color:#9e9d9d}.status-indicator.approved[_ngcontent-%COMP%]{color:#08920c}.status-indicator.declined[_ngcontent-%COMP%]{color:#d30808}button[_ngcontent-%COMP%]:disabled, input[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.3}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:20px}mat-paginator[_ngcontent-%COMP%]{display:flex;justify-content:center}"]})};export{re as AdminMovieRequestsComponent};
