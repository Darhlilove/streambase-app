<form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
  <div class="form-row">
    <mat-form-field appearance="outline">
      <mat-label>First Name</mat-label>
      <input matInput formControlName="firstName" placeholder="First Name" />
      @if (userForm.get('firstName')?.invalid &&
      userForm.get('firstName')?.touched) {
      <mat-error class="error">First name is required</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Last Name</mat-label>
      <input matInput formControlName="lastName" placeholder="Last Name" />
      @if (userForm.get('lastName')?.invalid &&
      userForm.get('lastName')?.touched) {
      <mat-error class="error">Last name is required</mat-error>
      }
    </mat-form-field>
  </div>

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Email</mat-label>
    <input matInput formControlName="email" placeholder="Email" type="email" />
    @if (userForm.get('email')?.invalid && userForm.get('email')?.touched) {
    <mat-error class="error">Email is required</mat-error>
    }
  </mat-form-field>

  @if (formType === 'register') {
  <div class="form-row">
    <mat-form-field appearance="outline">
      <mat-label>Password</mat-label>
      <input
        matInput
        formControlName="password"
        placeholder="Password"
        type="password"
      />
      @if (userForm.get('password')?.invalid &&
      userForm.get('password')?.touched) {
      <mat-error class="error">Password is required</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Confirm Password</mat-label>
      <input
        matInput
        formControlName="confirmPassword"
        placeholder="Confirm Password"
        type="password"
      />
      @if (userForm.get('confirmPassword')?.invalid &&
      userForm.get('confirmPassword')?.touched) {
      <mat-error class="error">Please confirm your password</mat-error>
      }
    </mat-form-field>
  </div>

  @if (userForm.errors?.['passwordMismatch'] &&
  userForm.get('confirmPassword')?.touched) {
  <div class="error-message">Passwords do not match</div>
  } }

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Date of Birth</mat-label>
    <input
      matInput
      [matDatepicker]="picker"
      formControlName="dateOfBirth"
      placeholder="Date of Birth"
    />
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
    @if (userForm.get('dateOfBirth')?.invalid &&
    userForm.get('dateOfBirth')?.touched) {
    <mat-error class="error">Date of birth is required</mat-error>
    }
  </mat-form-field>

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Bio</mat-label>
    <textarea
      matInput
      formControlName="bio"
      placeholder="Tell us about yourself"
      rows="2"
    ></textarea>
    @if (userForm.get('bio')?.invalid && userForm.get('bio')?.touched) {
    <mat-error class="error">Bio is required</mat-error>
    }
  </mat-form-field>

  <mat-form-field appearance="outline" class="full-width">
    <mat-label>Favorite Genres</mat-label>
    <mat-select formControlName="moviePreferences" multiple>
      <mat-option value="action">Action</mat-option>
      <mat-option value="adventure">Adventure</mat-option>
      <mat-option value="animation">Animation</mat-option>
      <mat-option value="comedy">Comedy</mat-option>
      <mat-option value="crime">Crime</mat-option>
      <mat-option value="documentary">Documentary</mat-option>
      <mat-option value="drama">Drama</mat-option>
      <mat-option value="family">Family</mat-option>
      <mat-option value="fantasy">Fantasy</mat-option>
      <mat-option value="history">History</mat-option>
      <mat-option value="horror">Horror</mat-option>
      <mat-option value="music">Music</mat-option>
      <mat-option value="mystery">Mystery</mat-option>
      <mat-option value="romance">Romance</mat-option>
      <mat-option value="science-fiction">Science Fiction</mat-option>
      <mat-option value="thriller">Thriller</mat-option>
      <mat-option value="war">War</mat-option>
      <mat-option value="western">Western</mat-option>
    </mat-select>
    @if (userForm.get('favoriteGenres')?.invalid &&
    userForm.get('favoriteGenres')?.touched) {
    <mat-error class="error">Please select at least one genre</mat-error>
    }
  </mat-form-field>

  @if (errorMessage) {
  <div class="error-message">{{ errorMessage }}</div>
  }

  <div class="form-actions">
    @if (formType === 'profile') {
    <button
      type="button"
      (click)="onCancel()"
      class="submit-button dark-button"
    >
      Cancel
    </button>
    }

    <button
      type="submit"
      class="submit-button primary-button"
      [disabled]="userForm.invalid || isSubmitting"
    >
      {{ formType === "register" ? "Sign Up" : "Save Changes" }}
    </button>
  </div>
</form>
